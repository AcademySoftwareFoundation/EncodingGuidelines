test_nvenc:
    name: test_nvenc_quality
    description: variations of nvenc_quality
    app: ffmpeg
    comparisontest:
    - testtype: identity
    - testtype: assertresults
      tests:
      - assert: equal
        value: Y
        equal: 1
      - assert: equal
        value: U
        equal: 1
      - assert: equal
        value: V
        equal: 1
    suffix: .mov
    encoding_template: '{ffmpeg_bin} {input_args} -colorspace bt709 -i "{source}" -vframes {duration} {encoding_args} -y "{outfile}"'
    sources:
    - ../sourceimages/smptehdbars_8.png
    - ../sourceimages/zoneplate_rgb16.png
    - sources/enc_sources/chimera_cars_srgb/chimera_cars_srgb.%05d.png.yml
    #- sources/enc_sources/chimera_coaster_srgb/chimera_coaster_srgb.%06d.png.yml
    #- sources/enc_sources/chimera_fountains_srgb/chimera_fountains_srgb.%05d.png.yml
    #- sources/hdr_sources/sparks_srgb/sparks_srgb.%05d.png.yml
    wedges:
        libx265-10bit: 
          -c:v: libx265
          -pix_fmt: yuv444p
          -x265-params: lossless=1
          -vf: '"scale=in_range=full:in_color_matrix=bt709:out_range=tv:out_color_matrix=bt709"'
          -color_primaries: bt709
          -color_range: tv
          -color_trc: bt709
          -colorspace: bt709

        hevc_nvenc_lossless: &base_args
            -c:v: hevc_nvenc
              #-profile:v: 3
            #-cq: 0
            -tune: lossless
            -pix_fmt: yuv444p
            -color_range: tv
            -colorspace: bt709
            -color_primaries: bt709
            -color_trc: bt709 

        h265_nvenc_scale:
             << : *base_args
             -vf: '"scale=in_range=full:in_color_matrix=bt709:out_range=tv:out_color_matrix=bt709"'
        #     -cq: 10

        # h264_nvenc_cq20:
        #     << : *base_args
        #     -cq: 20
---

reports:
    graphs:
    - args:
        color: name
        height: 400
        barmode: group
        x: media
        y: vmaf_harmonic_mean
        range_y:  
            - 90
            - 100
      name: vmaf_harmonic_mean.png
      type: bar
    - args:
        color: name
        height: 400
        x: media
        barmode: group
        y: encode_time
      name: encode_time.png
      type: bar
    - args:
        color: name
        height: 400
        x: media
        barmode: group
        y: filesize
      name: filesize.png
      type: bar
    name: nvenc-color
    title: Linux nvenc Comparison
    description: This is a comparison of different videotoolbox encodes.
    directory: nvenc-color-encode
    templatefile: basicimagecompare.html.jinja

