test_osx-oapv_bitrate:
    name: test_oapv_bitrate
    description: variations of oapv bitrate
    app: ffmpeg
    comparisontest:
    - testtype: vmaf3
    - testtype: yuvdiff
    - testtype: frame_extract
    suffix: .mov
    encoding_template: '{ffmpeg_bin} {input_args} -i "{source}" -vframes {duration} {encoding_args} -y "{outfile}"'
    sources:
    - sources/enc_sources/chimera_cars_srgb_dpx_10/chimera_cars_srgb.%05d.dpx.yml
    - sources/enc_sources/chimera_coaster_srgb_dpx_10/chimera_coaster_srgb.%06d.dpx.yml
    - sources/enc_sources/chimera_fountains_srgb_dpx_10/chimera_fountains_srgb.%05d.dpx.yml
    - sources/enc_sources/chimera_wind_srgb_dpx_10/chimera_wind_srgb.%06d.dpx.yml
    #- sources/hdr_sources/sparks_srgb/sparks_srgb.%05d.png.yml
    wedges:
        medium_b400: &base_args
            -c:v: liboapv
            -pix_fmt: yuv422p10le
            -b:v: 400000000
            -sws_flags: spline+accurate_rnd+full_chroma_int
            -vf: '"scale=in_range=full:in_color_matrix=bt709:out_range=tv:out_color_matrix=bt709"'
            -color_range: tv
            -colorspace: bt709
            -color_primaries: bt709
            -color_trc: iec61966-2-1 

        medium_b300:
            << : *base_args
            -b:v: 300000000

        medium_b250:
            << : *base_args
            -b:v: 250000000

        medium_b200:
            << : *base_args
            -b:v: 200000000

        medium_b150:
            << : *base_args
            -b:v: 150000000

        medium_b100:
            << : *base_args
            -b:v: 100000000

        medium_b050:
            << : *base_args
            -b:v: 50000000


---

reports:
    graphs:
    - args:
        color: media
        height: 400
        x: -b:v
        y: psnr_y_harmonic_mean
        markers: True
      name: psnr_y_harmonic_mean.png
      sortby: -b:v
    - args:
        color: media
        height: 400
        x: -b:v
        y: vmaf_harmonic_mean
        markers: True
      name: vmaf_harmonic_mean.png
      sortby: -b:v
    - args:
        color: media
        height: 400
        x: -b:v
        y: encode_time
        range_y: [0, 500]
        markers: True
      name: encode_time_zoom.png
      sortby: -b:v
    - args:
        color: media
        height: 400
        x: -b:v
        y: encode_time
        markers: True
      name: encode_time.png
      sortby: -b:v
    - args:
        color: media
        height: 400
        x: -b:v
        y: filesize
        markers: True
      name: filesize.png
      sortby: -b:v
    name: apv_bitrate
    title: OpenAPV 422p10 Bitrate Comparisons 
    description: This is a comparison of different APV bitrates for  422p10 
    directory: osx-oapv_bitrate-encode
    templatefile:
    - basicvmafimagecompare.html.jinja
    - compare.html.jinja

